<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Bot Config Generator</title>
    <!-- SheetJS library for Excel file processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            background: white;
            color: #007bff;
            border-bottom: 3px solid #007bff;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .help-text {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .optional {
            color: #6c757d;
            font-weight: normal;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 10px;
            margin-top: 10px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-1px);
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .download-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-top: 20px;
        }

        .download-section h4 {
            margin-bottom: 15px;
            color: #495057;
        }

        .file-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 6px;
            padding: 30px;
            text-align: center;
            margin: 15px 0;
            transition: border-color 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #007bff;
        }

        .file-upload-area.dragover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }

        .file-upload-input {
            display: none;
        }

        .file-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .footer {
            margin-top: 40px;
            padding: 20px 0;
            text-align: center;
            color: white;
        }

        .footer p {
            margin: 0;
            font-size: 1rem;
            opacity: 0.9;
        }

        .footer a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s ease;
        }

        .footer a:hover {
            opacity: 0.8;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tab-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Deakin Bot Config Generator</h1>
            <p>Generate configuration files for your Discord bot without any setup</p>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('bot', this)">Bot Customisation</button>
                <button class="tab" onclick="showTab('env', this)">Environment Variables</button>
                <button class="tab" onclick="showTab('download', this)">Download Files</button>
            </div>

            <div id="alert" class="alert"></div>

            <!-- Bot Customisation Tab -->
            <div id="bot-tab" class="tab-content active">
                <div class="section">
                    <h3>General Bot Settings</h3>
                    <div class="form-group">
                        <label for="botName">Bot Name</label>
                        <input type="text" id="botName" placeholder="Enter your bot's name" value="Discord Bot">
                    </div>
                    <div class="form-group">
                        <label for="organizationName">Club Name</label>
                        <input type="text" id="organizationName" placeholder="Your organisation or club name" value="Your Club">
                        <div class="help-text">Used in member messages and general references to your club</div>
                    </div>
                    <div class="form-group">
                        <label for="botColor">Bot Color (Hex)</label>
                        <input type="color" id="botColor" value="#00aeef">
                        <div class="help-text">This color will be used for embeds and UI elements</div>
                    </div>
                </div>

                <div class="section">
                    <h3>Bot Status & Activity</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="botActivityMessage">Bot Activity Message</label>
                            <input type="text" id="botActivityMessage" placeholder="What your bot is watching/playing" value="your community üëÄ">
                            <div class="help-text">The message shown in the bot's status (e.g., "Watching your community üëÄ")</div>
                        </div>
                        <div class="form-group">
                            <label for="botActivityType">Activity Type</label>
                            <select id="botActivityType">
                                <option value="Watching">Watching</option>
                                <option value="Playing">Playing</option>
                                <option value="Listening">Listening to</option>
                                <option value="Competing">Competing in</option>
                            </select>
                            <div class="help-text">The type of activity shown in the bot's status</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Whoami Command Customisation</h3>
                    <div class="form-group">
                        <label for="whoamiDescription">Bot Description</label>
                        <textarea id="whoamiDescription" placeholder="Enter a description for your bot that will appear in the /whoami command">A customisable Discord bot for your community.</textarea>
                    </div>
                    <div class="form-group">
                        <label for="footerText">Footer Text</label>
                        <input type="text" id="footerText" placeholder="Text to display in the footer of bot messages" value="Discord Bot Generator">
                    </div>
                </div>

                <div class="section">
                    <h3>Command Descriptions</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="whoamiCommandDesc">Whoami Command Description</label>
                            <input type="text" id="whoamiCommandDesc" placeholder="Description for the /whoami command" value="Display bot information">
                        </div>
                        <div class="form-group">
                            <label for="pingCommandDesc">Ping Command Description</label>
                            <input type="text" id="pingCommandDesc" placeholder="Description for the /ping command" value="Display latency and response time">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="commandsCommandDesc">Commands Command Description</label>
                            <input type="text" id="commandsCommandDesc" placeholder="Description for the /commands command" value="Display a list of all available commands">
                        </div>
                        <div class="form-group">
                            <label for="eightballCommandDesc">8ball Command Description</label>
                            <input type="text" id="eightballCommandDesc" placeholder="Description for the /8ball command" value="Ask the magic 8-ball a question">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="catCommandDesc">Cat Command Description</label>
                            <input type="text" id="catCommandDesc" placeholder="Description for the /cat command" value="Display a random cat HTTP status code">
                        </div>
                        <div class="form-group">
                            <label for="flipCommandDesc">Flip Command Description</label>
                            <input type="text" id="flipCommandDesc" placeholder="Description for the /flip command" value="Flip a virtual coin!">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="verifyCommandDesc">Verify Command Description</label>
                            <input type="text" id="verifyCommandDesc" placeholder="Description for the /verify command" value="Verify your membership and redeem the @Member role">
                        </div>
                        <div class="form-group">
                            <label for="calendarCommandDesc">Calendar Command Description</label>
                            <input type="text" id="calendarCommandDesc" placeholder="Description for the /calendar command" value="Display a list of upcoming events">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Button Configuration</h3>
                    <div class="help-text">These buttons will appear in the /whoami command to link to external sites</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="joinButtonText">Join Button Text</label>
                            <input type="text" id="joinButtonText" placeholder="e.g., Join Our Community">
                        </div>
                        <div class="form-group">
                            <label for="joinButtonUrl">Join Button URL</label>
                            <input type="url" id="joinButtonUrl" placeholder="https://discord.gg/your-invite">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="socialsButtonText">Socials Button Text</label>
                            <input type="text" id="socialsButtonText" placeholder="e.g., Follow Us">
                        </div>
                        <div class="form-group">
                            <label for="socialsButtonUrl">Socials Button URL</label>
                            <input type="url" id="socialsButtonUrl" placeholder="https://twitter.com/your-handle">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="githubButtonText">GitHub Button Text</label>
                            <input type="text" id="githubButtonText" placeholder="e.g., View Source">
                        </div>
                        <div class="form-group">
                            <label for="githubButtonUrl">GitHub Button URL</label>
                            <input type="url" id="githubButtonUrl" placeholder="https://github.com/your-repo">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Messages</h3>
                    <!--<div class="form-group">
                        <label for="welcomeMessage">Welcome Message</label>
                        <textarea id="welcomeMessage" placeholder="Message to display when new members join">Welcome to our community!</textarea>
                    </div>-->
                    <div class="form-group">
                        <label for="verificationMessage">Verification Message</label>
                        <textarea id="verificationMessage" placeholder="Message to display when members are verified">You have been successfully verified!</textarea>
                    </div>
                    
                    <h4 style="margin-top: 30px; margin-bottom: 15px; color: #495057;">Verification Command Messages</h4>
                    <div class="form-group">
                        <label for="verifySuccessMessage">Success Message</label>
                        <input type="text" id="verifySuccessMessage" placeholder="Message shown when verification succeeds" value="**You have been granted {roleName}!**">
                        <div class="help-text">Use {roleName} placeholder - automatically populated with the actual role name from Discord</div>
                    </div>
                    <div class="form-group">
                        <label for="verifySuccessDescription">Success Description</label>
                        <textarea id="verifySuccessDescription" placeholder="Additional description shown after successful verification">Explore {memberAnnouncementsChannel} and {memberResourcesChannel} for exclusive member content.</textarea>
                        <div class="help-text">Use {memberAnnouncementsChannel} and {memberResourcesChannel} placeholders - configure the actual channel IDs below</div>
                    </div>
                    
                    <h4 style="margin-top: 30px; margin-bottom: 15px; color: #495057;">Channel Configuration</h4>
                    <div class="help-text" style="margin-bottom: 15px; background: #e8f5e8; padding: 10px; border-radius: 4px; border-left: 4px solid #4caf50;">
                        <strong>üí° Easy Setup:</strong> Right-click your Discord channels and select "Copy Channel ID", then paste the numbers below. The bot will automatically format them as clickable channel links.
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="memberAnnouncementsChannelId">Member Announcements Channel ID</label>
                            <input type="text" id="memberAnnouncementsChannelId" placeholder="e.g., 1347067213160644659">
                            <div class="help-text">Right-click your announcements channel ‚Üí "Copy Channel ID"</div>
                        </div>
                        <div class="form-group">
                            <label for="memberResourcesChannelId">Member Resources Channel ID</label>
                            <input type="text" id="memberResourcesChannelId" placeholder="e.g., 1344439191110422588">
                            <div class="help-text">Right-click your resources channel ‚Üí "Copy Channel ID"</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="verifyAlreadyVerifiedMessage">Already Verified Message</label>
                        <input type="text" id="verifyAlreadyVerifiedMessage" placeholder="Message shown when user is already verified" value="You are already a **{roleName}** ‚Äî no further action needed!">
                        <div class="help-text">Use {roleName} placeholder - automatically populated with the actual role name from Discord</div>
                    </div>
                    
                    <h4 style="margin-top: 30px; margin-bottom: 15px; color: #495057;">Membership Expiration Notice</h4>
                    <div class="help-text" style="margin-bottom: 15px;">These settings control the DM message sent to users when their membership expires</div>
                    <div class="form-group">
                        <label for="expirationNoticeTitle">Expiration Notice Title</label>
                        <input type="text" id="expirationNoticeTitle" placeholder="Title of the expiration notice" value="üîî Membership Expiration Notice">
                    </div>
                    <div class="form-group">
                        <label for="expirationNoticeDescription">Expiration Notice Message</label>
                        <textarea id="expirationNoticeDescription" placeholder="Main message content for expiration notice" style="min-height: 120px;">Hi {fullName},

This is a friendly reminder that your membership expires **today**.

**As of next Friday, you will no longer have the @Member role** and will need to re-verify.

To maintain your membership benefits, please renew your membership and run the `/verify` command again next Friday evening.

Thank you for being a valued club member! üíó</textarea>
                        <div class="help-text">Use {fullName} placeholder - automatically populated from the membership database.</div>
                    </div>
                    <div class="form-group">
                        <label for="expirationNoticeFooter">Expiration Notice Footer</label>
                        <input type="text" id="expirationNoticeFooter" placeholder="Footer text for expiration notice" value="Your Club Membership System">
                    </div>
                    
                    <h4 style="margin-top: 30px; margin-bottom: 15px; color: #495057;">General Verification Messages</h4>
                    <div class="help-text" style="margin-bottom: 15px;">These settings control the footer messages shown in verification-related embeds</div>
                    <div class="form-group">
                        <label for="verificationFooterText">Verification Footer Text</label>
                        <input type="text" id="verificationFooterText" placeholder="Footer text for verification messages" value="Thank you for being a valued member! üíó">
                        <div class="help-text">Shown at the bottom of verification success and info messages</div>
                    </div>
                </div>

                <div style="background: #e8f5e8; border: 2px solid #4caf50; border-radius: 8px; padding: 15px; margin-top: 30px; text-align: center;">
                    <h4 style="color: #2e7d32; margin-bottom: 10px;">üí° Need inspiration?</h4>
                    <p style="color: #388e3c; margin-bottom: 15px;">See how DUCA (Deakin University Cybersecurity Association) would configure their bot</p>
                    <a href="example.html" class="btn btn-secondary" target="_blank">üìö View DUCA Example Configuration</a>
                </div>
            </div>

            <!-- Environment Variables Tab -->
            <div id="env-tab" class="tab-content">
                <div class="section">
                    <h3>Required Environment Variables</h3>
                    <div class="help-text">These variables are required for your bot to function properly</div>
                    <div class="form-group">
                        <label for="DISCORD_TOKEN">Discord Bot Token</label>
                        <input type="password" id="DISCORD_TOKEN" placeholder="Your Discord bot token from Discord Developer Portal">
                        <div class="help-text">Get this from the Discord Developer Portal</div>
                    </div>
                    <div class="form-group">
                        <label for="GUILD_ID">Guild ID (Server ID)</label>
                        <input type="text" id="GUILD_ID" placeholder="Your Discord server ID">
                        <div class="help-text">Right-click your server and select "Copy Server ID"</div>
                    </div>
                    <div class="form-group">
                        <label for="DEV_ROLE_ID">Developer Role ID</label>
                        <input type="text" id="DEV_ROLE_ID" placeholder="Role ID for bot developers/admins">
                        <div class="help-text">Right-click the role and select "Copy Role ID"</div>
                    </div>
                    <div class="form-group">
                        <label for="MEMBER_ROLE_ID">Member Role ID</label>
                        <input type="text" id="MEMBER_ROLE_ID" placeholder="Role ID for verified members">
                        <div class="help-text">Right-click the role and select "Copy Role ID"</div>
                    </div>
                </div>

                <div class="section">
                    <h3>Optional Environment Variables</h3>
                    <div class="help-text">These variables are optional and enable additional features</div>
                    <div class="form-group">
                        <label for="SUPABASE_URL">Supabase URL <span class="optional">(Optional)</span></label>
                        <input type="url" id="SUPABASE_URL" placeholder="Your Supabase project URL">
                        <div class="help-text">Required for member verification and calendar features</div>
                    </div>
                    <div class="form-group">
                        <label for="SUPABASE_ANON_KEY">Supabase Anonymous Key <span class="optional">(Optional)</span></label>
                        <input type="password" id="SUPABASE_ANON_KEY" placeholder="Your Supabase anonymous API key">
                        <div class="help-text">Found in your Supabase project settings</div>
                    </div>
                    <div class="form-group">
                        <label for="WEB_PORT">Web Port <span class="optional">(Optional)</span></label>
                        <input type="number" id="WEB_PORT" placeholder="3000" value="3000">
                        <div class="help-text">Port for the web configuration interface</div>
                    </div>
                </div>
            </div>

            <!-- Download Tab -->
            <div id="download-tab" class="tab-content">
                <div class="section">
                    <h3>Import Existing Configuration</h3>
                    <p>Upload an existing bot-config.json file to edit its values:</p>
                    
                    <div class="download-section">
                        <h4>Import bot-config.json</h4>
                        <p>Upload your existing configuration file to load all settings into the form above.</p>
                        
                        <div class="file-upload-area" onclick="document.getElementById('configFile').click()" ondrop="handleConfigDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                            <input type="file" id="configFile" class="file-upload-input" accept=".json" onchange="handleConfigUpload(event)">
                            <div id="config-upload-text">
                                <strong>Click to select a bot-config.json file</strong><br>
                                or drag and drop it here<br>
                                <small>Supported format: .json</small>
                            </div>
                        </div>
                        
                        <div id="config-file-info" class="file-info" style="display: none;"></div>
                        
                        <button class="btn btn-success" id="import-config-btn" onclick="importConfig()" style="display: none;">Import Configuration</button>
                    </div>
                </div>

                <div class="section">
                    <h3>Generated Configuration Files</h3>
                    <p>Review and download your configuration files below:</p>
                    
                    <div class="download-section">
                        <h4>Bot Configuration (bot-config.json)</h4>
                        <p>This file contains all your bot customisation settings.</p>
                        <button class="btn btn-primary" onclick="downloadBotConfig()">Download bot-config.json</button>
                        <button class="btn btn-secondary" onclick="togglePreview('bot')">Preview</button>
                        <div id="bot-preview" class="file-preview" style="display: none;"></div>
                    </div>

                    <div class="download-section">
                        <h4>Environment Variables (.env)</h4>
                        <p>This file contains your environment variables for the bot.</p>
                        <button class="btn btn-primary" onclick="downloadEnvFile()">Download .env</button>
                        <button class="btn btn-secondary" onclick="togglePreview('env')">Preview</button>
                        <div id="env-preview" class="file-preview" style="display: none;"></div>
                    </div>

                    <div class="download-section">
                        <h4>Excel to CSV Converter</h4>
                        <p>Upload an Excel file (.xlsx, .xls) to convert it to CSV format with empty columns removed.</p>
                        
                        <div class="file-upload-area" onclick="document.getElementById('excelFile').click()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                            <input type="file" id="excelFile" class="file-upload-input" accept=".xlsx,.xls" onchange="handleExcelUpload(event)">
                            <div id="upload-text">
                                <strong>Click to select an Excel file</strong><br>
                                or drag and drop it here<br>
                                <small>Supported formats: .xlsx, .xls</small>
                            </div>
                        </div>
                        
                        <div id="file-info" class="file-info" style="display: none;"></div>
                        
                        <button class="btn btn-success" id="convert-btn" onclick="convertAndDownload()" style="display: none;">Convert & Download CSV</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>Made with ‚ô•Ô∏è by <a href="https://duca.au" target="_blank" rel="noopener noreferrer">DUCA</a></p>
        </div>
    </footer>

    <script>
        function showTab(tabName, button) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to the correct tab button
            if (button) {
                // Button clicked directly
                button.classList.add('active');
            } else {
                // Called programmatically, find the right button
                const tabs = document.querySelectorAll('.tab');
                if (tabName === 'bot') {
                    tabs[0].classList.add('active');
                } else if (tabName === 'env') {
                    tabs[1].classList.add('active');
                } else if (tabName === 'download') {
                    tabs[2].classList.add('active');
                }
            }
        }

        function formatChannelId(channelId) {
            if (!channelId || !channelId.trim()) return '';
            // Remove any existing <# > formatting and whitespace
            const cleanId = channelId.trim().replace(/^<#/, '').replace(/>$/, '');
            // Validate it's a valid Discord ID (should be a long number)
            if (!/^\d{17,19}$/.test(cleanId)) return '';
            // Return properly formatted channel mention
            return `<#${cleanId}>`;
        }

        function getBotConfig() {
            return {
                botName: document.getElementById('botName').value || 'Discord Bot',
                organizationName: document.getElementById('organizationName').value || 'Your Club',
                botColor: document.getElementById('botColor').value || '#00aeef',
                botActivityMessage: document.getElementById('botActivityMessage').value || 'your community üëÄ',
                botActivityType: document.getElementById('botActivityType').value || 'Watching',
                whoamiDescription: document.getElementById('whoamiDescription').value || 'A customisable Discord bot for your community.',
                footerText: document.getElementById('footerText').value || 'Discord Bot Generator',
                verificationFooterText: document.getElementById('verificationFooterText').value || 'Thank you for being a valued member! üíó',
                memberAnnouncementsChannelId: document.getElementById('memberAnnouncementsChannelId').value || '',
                memberResourcesChannelId: document.getElementById('memberResourcesChannelId').value || '',
                joinButtonText: document.getElementById('joinButtonText').value || '',
                joinButtonUrl: document.getElementById('joinButtonUrl').value || '',
                socialsButtonText: document.getElementById('socialsButtonText').value || '',
                socialsButtonUrl: document.getElementById('socialsButtonUrl').value || '',
                githubButtonText: document.getElementById('githubButtonText').value || '',
                githubButtonUrl: document.getElementById('githubButtonUrl').value || '',
                verificationMessage: document.getElementById('verificationMessage').value || 'You have been successfully verified!',
                commandDescriptions: {
                    whoami: document.getElementById('whoamiCommandDesc').value || 'Display bot information',
                    ping: document.getElementById('pingCommandDesc').value || 'Display latency and response time',
                    commands: document.getElementById('commandsCommandDesc').value || 'Display a list of all available commands',
                    eightball: document.getElementById('eightballCommandDesc').value || 'Ask the magic 8-ball a question',
                    cat: document.getElementById('catCommandDesc').value || 'Display a random cat HTTP status code',
                    flip: document.getElementById('flipCommandDesc').value || 'Flip a virtual coin!',
                    verify: document.getElementById('verifyCommandDesc').value || 'Verify your membership and redeem the @Member role',
                    calendar: document.getElementById('calendarCommandDesc').value || 'Display a list of upcoming events'
                },
                commandTitles: {
                    commands: "$ commands",
                    commandsDescription: "**Commands Manual**\nBelow is a complete list of all slash commands separated by category:",
                    eightball: "$ 8-ball",
                    cat: "$ cat",
                    flip: "$ flip",
                    verify: "$ verify",
                    calendar: "$ calendar"
                },
                commandOutputs: {
                    commands: {
                        entertainmentTitle: "Fun",
                        entertainmentCommands: "`8ball` `cat` `flip`",
                        utilityTitle: "Utility",
                        utilityCommands: "`calendar` `ping` `verify`",
                        miscTitle: "Extra",
                        miscCommands: "`commands` `whoami`"
                    },
                    ping: {
                        title: "$ ping",
                        format: "\\> latency :: **{latency}ms**"
                    },
                    eightball: {
                        title: "$ 8-ball",
                        errorMessage: "We're sorry ‚Äî an unexpected error occurred!\n Please try again later or contact an administrator if the issue persists."
                    },
                    cat: {
                        title: "$ cat",
                        errorMessage: "We're sorry ‚Äî an unexpected error occurred!\n Please try again later or contact an administrator if the issue persists."
                    },
                    flip: {
                        title: "$ flip",
                        format: "\\> output :: **{result}**",
                        errorMessage: "We're sorry ‚Äî an unexpected error occurred!\n Please try again later or contact an administrator if the issue persists."
                    },
                    verify: {
                        title: "$ verify",
                        errorMessage: "We're sorry ‚Äî an unexpected error occurred.\n Please try again later or contact an administrator if the issue persists.",
                        successMessage: document.getElementById('verifySuccessMessage').value || "**You have been granted {roleName}!**",
                        successDescription: document.getElementById('verifySuccessDescription').value || "Explore {memberAnnouncementsChannel} and {memberResourcesChannel} for exclusive member content.",
                        alreadyVerifiedMessage: document.getElementById('verifyAlreadyVerifiedMessage').value || "You are already a **{roleName}** ‚Äî no further action needed!",
                        membershipExpirationNotice: {
                            title: document.getElementById('expirationNoticeTitle').value || "üîî Membership Expiration Notice",
                            description: document.getElementById('expirationNoticeDescription').value || "Hi {fullName},\n\nThis is a friendly reminder that your membership expires **today**.\n\n**As of next Friday, you will no longer have the @Member role** and will need to re-verify.\n\nTo maintain your membership benefits, please renew your membership and run the `/verify` command again next Friday evening.\n\nThank you for being a valued {club} member! üíó",
                            footer: document.getElementById('expirationNoticeFooter').value || "Your Club Membership System"
                        },
                        memberAnnouncementsChannel: formatChannelId(document.getElementById('memberAnnouncementsChannelId').value) || "",
                        memberResourcesChannel: formatChannelId(document.getElementById('memberResourcesChannelId').value) || ""
                    },
                    calendar: {
                        title: "$ calendar",
                        noEventsMessage: "No upcoming events found matching those filters.\n Try adjusting your query or please try again later.",
                        errorMessage: "We're sorry ‚Äî an unexpected error occurred!\n Please try again later or contact an administrator if the issue persists.",
                        lastUpdatedText: "Last Updated"
                    }
                }
            };
        }

        function getEnvConfig() {
            return {
                DISCORD_TOKEN: document.getElementById('DISCORD_TOKEN').value || '',
                GUILD_ID: document.getElementById('GUILD_ID').value || '',
                DEV_ROLE_ID: document.getElementById('DEV_ROLE_ID').value || '',
                MEMBER_ROLE_ID: document.getElementById('MEMBER_ROLE_ID').value || '',
                SUPABASE_URL: document.getElementById('SUPABASE_URL').value || '',
                SUPABASE_ANON_KEY: document.getElementById('SUPABASE_ANON_KEY').value || '',
                WEB_PORT: document.getElementById('WEB_PORT').value || '3000',
            };
        }

        function downloadBotConfig() {
            const config = getBotConfig();
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bot-config.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showAlert('bot-config.json downloaded successfully!', 'success');
        }

        function downloadEnvFile() {
            const envConfig = getEnvConfig();
            let envContent = '';
            for (const [key, value] of Object.entries(envConfig)) {
                if (value) {
                    envContent += `${key}=${value}\n`;
                }
            }

            const blob = new Blob([envContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '.env';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showAlert('.env file downloaded successfully!', 'success');
        }

        function togglePreview(type) {
            const preview = document.getElementById(type + '-preview');
            if (preview.style.display === 'none') {
                if (type === 'bot') {
                    preview.textContent = JSON.stringify(getBotConfig(), null, 2);
                } else if (type === 'env') {
                    const envConfig = getEnvConfig();
                    let envContent = '';
                    for (const [key, value] of Object.entries(envConfig)) {
                        if (value) {
                            envContent += `${key}=${value}\n`;
                        }
                    }
                    preview.textContent = envContent;
                }
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Auto-save configuration to localStorage
        function saveToLocalStorage() {
            const config = {
                bot: getBotConfig(),
                env: getEnvConfig()
            };
            localStorage.setItem('discordBotConfig', JSON.stringify(config));
        }

        // Load configuration from localStorage
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('discordBotConfig');
            if (saved) {
                try {
                    const config = JSON.parse(saved);
                    
                    // Load bot config
                    if (config.bot) {
                        document.getElementById('botName').value = config.bot.botName || 'Discord Bot';
                        document.getElementById('organizationName').value = config.bot.organizationName || 'Your Club';
                        document.getElementById('botColor').value = config.bot.botColor || '#00aeef';
                        document.getElementById('botActivityMessage').value = config.bot.botActivityMessage || '';
                        document.getElementById('botActivityType').value = config.bot.botActivityType || 'Watching';
                        document.getElementById('whoamiDescription').value = config.bot.whoamiDescription || '';
                        document.getElementById('footerText').value = config.bot.footerText || '';
                        document.getElementById('verificationFooterText').value = config.bot.verificationFooterText || '';
                        document.getElementById('memberAnnouncementsChannelId').value = config.bot.memberAnnouncementsChannelId || '';
                        document.getElementById('memberResourcesChannelId').value = config.bot.memberResourcesChannelId || '';
                        document.getElementById('joinButtonText').value = config.bot.joinButtonText || '';
                        document.getElementById('joinButtonUrl').value = config.bot.joinButtonUrl || '';
                        document.getElementById('socialsButtonText').value = config.bot.socialsButtonText || '';
                        document.getElementById('socialsButtonUrl').value = config.bot.socialsButtonUrl || '';
                        document.getElementById('githubButtonText').value = config.bot.githubButtonText || '';
                        document.getElementById('githubButtonUrl').value = config.bot.githubButtonUrl || '';
                        document.getElementById('verificationMessage').value = config.bot.verificationMessage || '';
                        
                        // Load new verification message fields
                        if (config.bot.commandOutputs && config.bot.commandOutputs.verify) {
                            const verifyConfig = config.bot.commandOutputs.verify;
                            document.getElementById('verifySuccessMessage').value = verifyConfig.successMessage || '';
                            document.getElementById('verifySuccessDescription').value = verifyConfig.successDescription || '';
                            document.getElementById('verifyAlreadyVerifiedMessage').value = verifyConfig.alreadyVerifiedMessage || '';
                            
                            if (verifyConfig.membershipExpirationNotice) {
                                document.getElementById('expirationNoticeTitle').value = verifyConfig.membershipExpirationNotice.title || '';
                                document.getElementById('expirationNoticeDescription').value = verifyConfig.membershipExpirationNotice.description || '';
                                document.getElementById('expirationNoticeFooter').value = verifyConfig.membershipExpirationNotice.footer || '';
                            }
                            
                            // Load channel IDs (extract just the ID from <#ID> format)
                            if (verifyConfig.memberAnnouncementsChannel) {
                                const announcementsId = verifyConfig.memberAnnouncementsChannel.replace(/^<#/, '').replace(/>$/, '');
                                document.getElementById('memberAnnouncementsChannelId').value = announcementsId;
                            }
                            if (verifyConfig.memberResourcesChannel) {
                                const resourcesId = verifyConfig.memberResourcesChannel.replace(/^<#/, '').replace(/>$/, '');
                                document.getElementById('memberResourcesChannelId').value = resourcesId;
                            }
                        }
                        
                        if (config.bot.commandDescriptions) {
                            document.getElementById('whoamiCommandDesc').value = config.bot.commandDescriptions.whoami || '';
                            document.getElementById('pingCommandDesc').value = config.bot.commandDescriptions.ping || '';
                            document.getElementById('commandsCommandDesc').value = config.bot.commandDescriptions.commands || '';
                            document.getElementById('eightballCommandDesc').value = config.bot.commandDescriptions.eightball || '';
                            document.getElementById('catCommandDesc').value = config.bot.commandDescriptions.cat || '';
                            document.getElementById('flipCommandDesc').value = config.bot.commandDescriptions.flip || '';
                            document.getElementById('verifyCommandDesc').value = config.bot.commandDescriptions.verify || '';
                            document.getElementById('calendarCommandDesc').value = config.bot.commandDescriptions.calendar || '';
                        }
                    }
                    
                    // Load env config
                    if (config.env) {
                        document.getElementById('DISCORD_TOKEN').value = config.env.DISCORD_TOKEN || '';
                        document.getElementById('GUILD_ID').value = config.env.GUILD_ID || '';
                        document.getElementById('DEV_ROLE_ID').value = config.env.DEV_ROLE_ID || '';
                        document.getElementById('MEMBER_ROLE_ID').value = config.env.MEMBER_ROLE_ID || '';
                        document.getElementById('SUPABASE_URL').value = config.env.SUPABASE_URL || '';
                        document.getElementById('SUPABASE_ANON_KEY').value = config.env.SUPABASE_ANON_KEY || '';
                        document.getElementById('WEB_PORT').value = config.env.WEB_PORT || '3000';
                    }
                } catch (error) {
                    console.error('Error loading saved configuration:', error);
                }
            }
        }

        // Add event listeners for auto-save
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            
            // Auto-save on input changes
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', saveToLocalStorage);
            });
        });

        // Excel to CSV conversion functions
        let uploadedFile = null;

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    processExcelFile(file);
                } else {
                    showAlert('Please upload a valid Excel file (.xlsx or .xls)', 'error');
                }
            }
        }

        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processExcelFile(file);
            }
        }

        function processExcelFile(file) {
            uploadedFile = file;
            
            // Show file info
            const fileInfo = document.getElementById('file-info');
            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            fileInfo.innerHTML = `
                <strong>File:</strong> ${file.name}<br>
                <strong>Size:</strong> ${fileSize} MB<br>
                <strong>Type:</strong> ${file.type || 'Excel file'}
            `;
            fileInfo.style.display = 'block';
            
            // Show convert button
            document.getElementById('convert-btn').style.display = 'inline-block';
            
            showAlert('Excel file uploaded successfully! Click "Convert & Download CSV" to process.', 'success');
        }

        function convertAndDownload() {
            if (!uploadedFile) {
                showAlert('Please upload an Excel file first', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // Parse the Excel file
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get the first worksheet
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Convert to JSON to work with the data
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
                    
                    if (jsonData.length === 0) {
                        showAlert('The Excel file appears to be empty', 'error');
                        return;
                    }
                    
                    // Remove empty columns
                    const cleanedData = removeEmptyColumns(jsonData);
                    
                    if (cleanedData.length === 0 || cleanedData[0].length === 0) {
                        showAlert('No data found after removing empty columns', 'error');
                        return;
                    }
                    
                    // Convert to CSV
                    const csvContent = arrayToCSV(cleanedData);
                    
                    // Download the CSV
                    downloadCSV(csvContent, uploadedFile.name);
                    
                } catch (error) {
                    console.error('Error processing Excel file:', error);
                    showAlert('Error processing the Excel file. Please make sure it\'s a valid Excel file.', 'error');
                }
            };
            
            reader.readAsArrayBuffer(uploadedFile);
        }

        function removeEmptyColumns(data) {
            if (data.length === 0) return data;
            
            const maxCols = Math.max(...data.map(row => row.length));
            const columnsToKeep = [];
            
            // Check each column for non-empty values
            for (let col = 0; col < maxCols; col++) {
                let hasContent = false;
                for (let row = 0; row < data.length; row++) {
                    const cellValue = data[row][col];
                    if (cellValue !== undefined && cellValue !== null && cellValue !== '') {
                        hasContent = true;
                        break;
                    }
                }
                if (hasContent) {
                    columnsToKeep.push(col);
                }
            }
            
            // Create new data with only non-empty columns
            return data.map(row => columnsToKeep.map(col => row[col] || ''));
        }

        function arrayToCSV(data) {
            return data.map(row => 
                row.map(cell => {
                    // Handle cells that contain commas, quotes, or newlines
                    const cellStr = String(cell || '');
                    if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                        return '"' + cellStr.replace(/"/g, '""') + '"';
                    }
                    return cellStr;
                }).join(',')
            ).join('\n');
        }

        function downloadCSV(csvContent, originalFileName) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            // Generate filename
            const baseName = originalFileName.replace(/\.[^/.]+$/, '');
            const fileName = `${baseName}_converted.csv`;
            
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert(`CSV file "${fileName}" downloaded successfully!`, 'success');
        }

        // New functions for importing bot-config.json
        function handleConfigDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.name.endsWith('.json')) {
                    processConfigFile(file);
                } else {
                    showAlert('Please upload a valid bot-config.json file', 'error');
                }
            }
        }

        function handleConfigUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processConfigFile(file);
            }
        }

        let uploadedConfigFile = null;

        function processConfigFile(file) {
            uploadedConfigFile = file;
            
            // Show file info
            const fileInfo = document.getElementById('config-file-info');
            const fileSize = (file.size / 1024).toFixed(2);
            fileInfo.innerHTML = `
                <strong>File:</strong> ${file.name}<br>
                <strong>Size:</strong> ${fileSize} KB<br>
                <strong>Type:</strong> JSON Configuration
            `;
            fileInfo.style.display = 'block';
            
            // Show import button
            document.getElementById('import-config-btn').style.display = 'inline-block';
            
            showAlert('Config file uploaded successfully! Click "Import Configuration" to load the settings.', 'success');
        }

        function importConfig() {
            if (!uploadedConfigFile) {
                showAlert('Please upload a bot-config.json file first', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    if (config && typeof config === 'object') {
                        // Populate the form fields from the imported config
                        document.getElementById('botName').value = config.botName || 'Discord Bot';
                        document.getElementById('organizationName').value = config.organizationName || 'Your Club';
                        document.getElementById('botColor').value = config.botColor || '#00aeef';
                        document.getElementById('botActivityMessage').value = config.botActivityMessage || 'your community üëÄ';
                        document.getElementById('botActivityType').value = config.botActivityType || 'Watching';
                        document.getElementById('whoamiDescription').value = config.whoamiDescription || 'A customisable Discord bot for your community.';
                        document.getElementById('footerText').value = config.footerText || 'Discord Bot Generator';
                        document.getElementById('verificationFooterText').value = config.verificationFooterText || 'Thank you for being a valued member! üíó';
                        document.getElementById('memberAnnouncementsChannelId').value = config.memberAnnouncementsChannelId || '';
                        document.getElementById('memberResourcesChannelId').value = config.memberResourcesChannelId || '';
                        document.getElementById('joinButtonText').value = config.joinButtonText || '';
                        document.getElementById('joinButtonUrl').value = config.joinButtonUrl || '';
                        document.getElementById('socialsButtonText').value = config.socialsButtonText || '';
                        document.getElementById('socialsButtonUrl').value = config.socialsButtonUrl || '';
                        document.getElementById('githubButtonText').value = config.githubButtonText || '';
                        document.getElementById('githubButtonUrl').value = config.githubButtonUrl || '';
                        document.getElementById('verificationMessage').value = config.verificationMessage || 'You have been successfully verified!';
                        
                        // Populate new verification message fields
                        if (config.commandOutputs && config.commandOutputs.verify) {
                            const verifyConfig = config.commandOutputs.verify;
                            document.getElementById('verifySuccessMessage').value = verifyConfig.successMessage || '';
                            document.getElementById('verifySuccessDescription').value = verifyConfig.successDescription || '';
                            document.getElementById('verifyAlreadyVerifiedMessage').value = verifyConfig.alreadyVerifiedMessage || '';
                            
                            if (verifyConfig.membershipExpirationNotice) {
                                document.getElementById('expirationNoticeTitle').value = verifyConfig.membershipExpirationNotice.title || '';
                                document.getElementById('expirationNoticeDescription').value = verifyConfig.membershipExpirationNotice.description || '';
                                document.getElementById('expirationNoticeFooter').value = verifyConfig.membershipExpirationNotice.footer || '';
                            }
                            
                            // Load channel IDs (extract just the ID from <#ID> format)
                            if (verifyConfig.memberAnnouncementsChannel) {
                                const announcementsId = verifyConfig.memberAnnouncementsChannel.replace(/^<#/, '').replace(/>$/, '');
                                document.getElementById('memberAnnouncementsChannelId').value = announcementsId;
                            }
                            if (verifyConfig.memberResourcesChannel) {
                                const resourcesId = verifyConfig.memberResourcesChannel.replace(/^<#/, '').replace(/>$/, '');
                                document.getElementById('memberResourcesChannelId').value = resourcesId;
                            }
                        }
                        
                        if (config.commandDescriptions) {
                            document.getElementById('whoamiCommandDesc').value = config.commandDescriptions.whoami || '';
                            document.getElementById('pingCommandDesc').value = config.commandDescriptions.ping || '';
                            document.getElementById('commandsCommandDesc').value = config.commandDescriptions.commands || '';
                            document.getElementById('eightballCommandDesc').value = config.commandDescriptions.eightball || '';
                            document.getElementById('catCommandDesc').value = config.commandDescriptions.cat || '';
                            document.getElementById('flipCommandDesc').value = config.commandDescriptions.flip || '';
                            document.getElementById('verifyCommandDesc').value = config.commandDescriptions.verify || '';
                            document.getElementById('calendarCommandDesc').value = config.commandDescriptions.calendar || '';
                        }
                        
                        // Save to localStorage for persistence
                        saveToLocalStorage();
                        
                        showAlert('Configuration imported successfully! All form fields have been updated. Switch to "Bot Customisation" tab to see the imported values.', 'success');
                        
                        // Switch to the Bot Customisation tab to show the imported values
                        showTab('bot');
                        
                    } else {
                        showAlert('The uploaded file does not contain a valid bot configuration.', 'error');
                    }
                } catch (error) {
                    console.error('Error processing config file:', error);
                    showAlert('Error processing the config file. Please ensure it\'s a valid JSON file.', 'error');
                }
            };
            
            reader.readAsText(uploadedConfigFile);
        }
    </script>
</body>
</html> 